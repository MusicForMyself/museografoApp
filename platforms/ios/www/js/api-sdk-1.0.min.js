function requestHandlerAPI(){this.token=null,this.version="1.0",this.app_build="1.4.1",this.device_model="undefined"!=typeof device?device.model:"not set",this.device_platform="undefined"!=typeof device?device.platform:"not set",this.device_platform_version="undefined"!=typeof device?device.version:"not set",this.device_info={sdk_version:this.version,build:this.app_build,model:this.device_model,platform:this.device_platform,version:this.device_platform_version};var e=this;window.sdk_app_context=null,window.api_base_url="http://museografo.com/rest/v1/",this.ls=window.localStorage,this.construct=function(e){return console.log("Initialized rest API Los Maquiladores sdk v0.1"),this.ls.getItem("request_token")&&(this.token=this.ls.getItem("request_token")),sdk_app_context=e,this},this.loginNative=function(e){var t={user_login:e.user_login,user_password:e.user_password,request_token:apiRH.get_request_token()},i=this.makeRequest("auth/login/",t);return i.success?i.data:!1},this.registerNative=function(e){var t={username:e.user_login_reg,email:e.user_email_reg,attrs:{password:e.user_password_reg,country:e.user_country,province:e.user_province,request_token:apiRH.get_request_token()}},i=this.makeRequest("auth/user/",t);return console.log(i),i.success?i.data:!1},this.logOut=function(e){return this.makeRequest("auth/"+e.user_login+"/logout/",{request_token:e.request_token})},this.create_internal_user=function(e,t,i){var s,o,n,a=null;return a=this.getRequest("user/exists/",e),console.log(JSON.stringify(a)),a.success?(console.log("User already exists, saving data"),this.save_user_data_clientside(a.data),s={user_id:"none",token:apiRH.get_request_token(),validate_id:a.data.user_id?a.data.user_id:"none"},void(o=this.makeRequest("user/validateToken/",s))):(console.log("Creating new user"),s={email:t,username:e,attrs:i},console.log(JSON.stringify(s)),o=this.makeRequest("auth/user/",s),console.log("Save client side"),a=this.getRequest("user/exists/",e),console.log(JSON.stringify(a)),this.save_user_data_clientside(a.data),s={user_id:"none",token:apiRH.get_request_token(),validate_id:window.localStorage.getItem("user_id")?window.localStorage.getItem("user_id"):"none"},o=this.makeRequest("user/validateToken/",s),app.toast("Usuario creado exitosamente, bienvenido"),n=o.success?!0:!1)},this.save_user_data_clientside=function(e){var t=e.role;"administrator"==t&&(t="subscriber"),this.ls.setItem("museo_log_info",JSON.stringify({user_login:e.user_login,username:e.user_login,user_id:e.user_id,user_role:e.role,user_profile:e.profile_url}))},this.request_token=function(){var e=this.getRequest("auth/getToken/",null);return e.success!==!1?(this.token=e.data.request_token,this.ls.setItem("request_token",e.data.request_token),this):this},this.set_user_token=function(){},this.execute=function(e,t,i){return"POST"===e?this.makeRequest(t,i):"GET"===e?this.getRequest(t,i):"PUT"===e?this.putRequest(t,i):void 0},this.has_token=function(){return"undefined"!=typeof this.token||""!==this.token?this.token:!1},this.has_valid_token=function(){if(void 0!==this.token||""!==this.token){console.log("Looks like you already have a token, let's check if it is valid");var e=void 0!=typeof this.ls.getItem("museo_log_info")?JSON.parse(this.ls.getItem("museo_log_info")):null;if(!e)return!1;var t=e.user_id,i={user_id:t,request_token:apiRH.get_request_token(),device_info:this.device_info},s=this.makeRequest("auth/user/checkToken/",i),o=s.success?!0:!1}return o},this.get_request_token=function(){return this.token},this.makeRequest=function(e,t){sdk_app_context.showLoader();var i={};return $.ajax({type:"POST",url:window.api_base_url+e,data:t,dataType:"json",async:!1}).done(function(e){i=e,sdk_app_context.hideLoader()}).fail(function(e){i=!1,console.log(JSON.stringify(e))}),i},this.getRequest=function(e,t){sdk_app_context.showLoader();var i={};return e=null===t?e:e+t,$.getJSON(window.api_base_url+e,function(e){i=e,sdk_app_context.hideLoader()}),i},this.putRequest=function(e,t){sdk_app_context.showLoader();var i={};return $.ajax({type:"PUT",data:$.param(t),contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:window.api_base_url+e}).done(function(e){i=e,sdk_app_context.hideLoader()}).fail(function(e){i=!1,console.log(e)}),i},this.loginOauth=function(e,t){sdk_app_context.showLoader(),OAuth.popup(e).done(t).fail(function(e){console.log(e)})},this.loginCallbackTW=function(e){e.get("/1.1/account/verify_credentials.json").done(function(e){var t=e.screen_name+"@fake.mail",i=e.screen_name,s=apiRH.create_internal_user(i,t,{twitter_username:i},window.localStorage.getItem("request_token"));return s?void app.toast("El usuario ya existe"):(app.toast("Bienvenido"),void window.location.assign("feed.html?filter_feed=all"))}).fail(function(e){console.log(e)})},this.loginCallbackFB=function(e){e.me().done(function(e){var t=e.email,i=e.lastname+"_"+e.id,s=apiRH.create_internal_user(i,t,[],window.localStorage.getItem("request_token"));return s?app.toast("El usuario ya existe"):void window.location.assign("feed.html?filter_feed=all")}).fail(function(e){console.log(e)})},this.loginCallbackGP=function(e){e.get("/plus/v1/people/me").done(function(e){var t=e.name.familyName+e.id+"@fake.mail",i=e.name.familyName+e.id,s=s=apiRH.create_internal_user(i,t,{gplus_username:i},window.localStorage.getItem("request_token"));return s?void window.location.assign("feed.html?filter_feed=all"):void window.location.assign("feed.html?filter_feed=all")}).fail(function(e){console.log(e)})},this.transfer_win=function(){app.toast("Se ha publicado una imagen"),window.location.reload(!0)},this.profile_transfer_win=function(){app.toast("Imagen de perfil modificada"),window.location.reload(!0)},this.transfer_fail=function(e){console.log(e),alert("An error has occurred: Code = "+e.code),console.log("upload error source "+e.source),console.log("upload error target "+e.target)},this.initializeEventFileTransfer=function(t){app.showLoader(),this.transfer_options=new FileUploadOptions,this.transfer_options.fileKey="file",this.transfer_options.fileName=t.substr(t.lastIndexOf("/")+1),this.transfer_options.mimeType="image/jpeg";var i={};i.client="app",this.transfer_options.params=i;var s=new FileTransfer,o=window.localStorage,n=o.getItem("museo_last_selected_event");s.upload(t,encodeURI(api_base_url+"transfers/"+user+"/event_upload/"+n+"/"),e.transfer_win,e.transfer_fail,this.transfer_options)},this.initializeProfileFileTransfer=function(t){app.showLoader(),this.transfer_options=new FileUploadOptions,this.transfer_options.fileKey="file",this.transfer_options.fileName=t.substr(t.lastIndexOf("/")+1),this.transfer_options.mimeType="image/jpeg";var i={};i.client="app",this.transfer_options.params=i;var s=new FileTransfer;s.upload(t,encodeURI(api_base_url+"transfers/"+user+"/profile/"),e.profile_transfer_win,e.transfer_fail,this.transfer_options)},this.fileselect_win=function(t){(t||""!=t)&&e.initializeEventFileTransfer(t)},this.profileselect_win=function(t){(t||""!=t)&&e.initializeProfileFileTransfer(t)},this.fileselect_fail=function(e){alert("An error has occurred: "+e)},this.getFileFromDevice=function(t,i){this.photoDestinationType=navigator.camera.DestinationType;var i=navigator.camera.PictureSourceType.PHOTOLIBRARY;"camera"==i&&(i=navigator.camera.PictureSourceType.CAMERA),"profile"==t&&navigator.camera.getPicture(e.profileselect_win,e.fileselect_fail,{quality:50,destinationType:this.photoDestinationType.FILE_URI,sourceType:i,mediaType:navigator.camera.MediaType.ALLMEDIA}),"event"==t&&navigator.camera.getPicture(e.fileselect_win,e.fileselect_fail,{quality:50,destinationType:this.photoDestinationType.FILE_URI,sourceType:i,mediaType:navigator.camera.MediaType.ALLMEDIA})}}